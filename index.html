<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset='utf-8'>
    <title>Try Amalgamate!</title>
    <link href='web/bootstrap.min.css' rel='stylesheet'>
    <style>
        textarea, pre {width: 100%; height: 20em; font-family: monospace}
        pre {width: 100%; height: 17em; font-family: monospace}
    </style>
    </head>
    <body>

    <div class='container'>
        <h1>Try Amalgamate!</h1>

        <p>For more information, checkout the readme at <a href='https://github.com/awagner83/amalgamate'>github</a>.</p>

        <select id='example' class='form-control input-lg'></select>

        <div class='row'>
            <div class='col-md-4'>
                <h3>Template</h3>
                <textarea id='template'></textarea>
            </div>
            <div class='col-md-4'>
                <h3>Context</h3>
                <textarea id='context'></textarea>
            </div>
            <div class='col-md-4'>
                <h3>Raw Output</h3>
                <pre id='output'></pre>
                <div id='time' class='alert alert-success'></div>
            </div>
        </div>

        <h3>HTML Output</h3>
        <div class='well' id='htmlOutput'></div>
    </div>

    <div style='display: none;'>
<div id='replace'>
Hello {{where}}
</div>
<div id='replace_context'>
{
    where: 'world'
}
</div>
<div id='deepReplace'>
Hello {{thisPlace.where}}!
</div>
<div id='deepReplace_context'>
{
    thisPlace: {
        where: 'The Internet'
    }
}
</div>
<div id='objectScoping'>
Hello {{@person}} {{firstName}} {{lastName}} {{/person}}!
</div>
<div id='objectScoping_context'>
{
    person: {
        firstName: 'Bob',
        lastName: 'Smith'
    }
}
</div>
<div id='arrayIteration'>
{{#people}}
    {{firstName}} {{lastName}}<br>
{{/people}}
</div>
<div id='arrayIteration_context'>
{
    people: [
        {firstName: 'Bob', lastName: 'Smith'},
        {firstName: 'Judy', lastName: 'Smith'}
    ]
}
</div>
<div id='existenceCheck'>
{{#people}}
    {{?child}}Little {{/child}}
    {{firstName}} {{lastName}}<br>
{{/people}}
</div>
<div id='existenceCheck_context'>
{
    people: [
        {firstName: 'Bob', lastName: 'Smith'},
        {firstName: 'Bobby', lastName: 'Smith', child: true},
        {firstName: 'Judy', lastName: 'Smith'}
    ]
}
</div>
<div id='existenceWithElse'>
{{?people}}
    Yes here is the list
{{:else}}
    Nope, no one here
{{/people}}
</div>
<div id='existenceWithElse_context'>
{}
</div>
<div id='inverseExistence'>
{{^people}}
    No people here.
{{/people}}
</div>
<div id='inverseExistence_context'>
{}
</div>
<div id='inverseExistenceWithElse'>
{{^people}}
    No people here.
{{:else}}
    Yes, here is the list!
{{/people}}
</div>
<div id='inverseExistenceWithElse_context'>
{
    people: ['people', 'list', 'goes', 'here']
}
</div>
<div id='filters'>
{{name|shout}}
</div>
<div id='filters_context'>
{
    name: 'bob',
    shout: function(str) {
        return str.toUpperCase() + '!';
    }
}
</div>
    </div>

    <script src='dist/amalgamate-min.js'></script>
    <script src='web/jquery.min.js'></script>
    <script src='web/bootstrap.min.js'></script>
    <script type='text/javascript'>

        if (!String.prototype.trim) {
            String.prototype.trim = function () {
                return this.replace(/^\s+|\s+$/g, '');
            };
        }

        var examples = [
            { 'name': 'Replace', 'id': 'replace' },
            { 'name': 'Deep Replace', 'id': 'deepReplace' },
            { 'name': 'Object Scoping', 'id': 'objectScoping' },
            { 'name': 'Array Iteration', 'id': 'arrayIteration' },
            { 'name': 'Existence Check', 'id': 'existenceCheck' },
            { 'name': 'Existence Check (with else)', 'id': 'existenceWithElse' },
            { 'name': 'Inverse Existing Check', 'id': 'inverseExistence' },
            { 'name': 'Inverse Existing Check (with else)', 'id': 'inverseExistenceWithElse' },
            { 'name': 'Filters', 'id': 'filters'}
        ];

        var examplesIndex = {};
        for (var i = 0, len = examples.length; i < len; i++) {
            examplesIndex[examples[i].name] = examples[i];
        }

        var populateExampleBox = function() {
            var tpl = Amalgamate.load(Amalgamate.compile(
                        "{{#examples}}<option value='{{name}}'>{{name}}</option>{{/examples}}"));
            $('#example').html(Amalgamate.render(tpl, {examples: examples}));
        };

        var updateContextAndTemplate = function() {
            var selected = examplesIndex[$('#example').val()];
            $('#template').html($('#' + selected.id).html().trim());
            $('#context').html($('#' + selected.id + "_context").html().trim());
            render();
        };

        var render = function() {
            var out = $("#output");
            var htmlout = $("#htmlOutput");
            var time = $("#time");
            try {
                eval("var context = " + $("#context").val());
            } catch (ex) {
                out.html("Invalid context: " + ex);
            }
            var template = Amalgamate.load(Amalgamate.compile($("#template").val())),
                start = performance.now(),
                output = Amalgamate.render(template, context),
                end = performance.now();

            out.html(output.replace(/</g, '&lt;'));
            htmlout.html(output);
            time.html("Template rendered in <b>" + (end - start).toFixed(3) + "ms</b>");
        };

        $('#example').change(updateContextAndTemplate);
        $('#context,#template').keyup(render);

        populateExampleBox();
        updateContextAndTemplate();
    </script>
    </body>
</html>
