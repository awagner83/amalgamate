<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset='utf-8'>
    <title>Try Amalgamate!</title>
    <link href='web/bootstrap.min.css' rel='stylesheet'>
    <style>
        textarea, pre {width: 100%; height: 20em; font-family: monospace}
        pre {width: 100%; height: 17em; font-family: monospace}
    </style>
    </head>
    <body>

    <div class='container'>
        <h1>Try Amalgamate!</h1>

        <p>For more information, checkout the readme at <a href='https://github.com/awagner83/amalgamate'>github</a>.</p>

        <select id='example' class='form-control input-lg'></select>

        <div class='row'>
            <div class='col-md-4'>
                <h3>Template</h3>
                <textarea id='template'></textarea>
            </div>
            <div class='col-md-4'>
                <h3>Context</h3>
                <textarea id='context'></textarea>
            </div>
            <div class='col-md-4'>
                <h3>Raw Output</h3>
                <pre id='output'></pre>
                <div id='time' class='alert alert-success'></div>
            </div>
        </div>

        <h3>HTML Output</h3>
        <div class='well' id='htmlOutput'></div>
    </div>

    <div style='display: none;'>
<div id='replace'>
Hello {{where}}
</div>
<div id='deepReplace'>
Hello {{thisPlace.where}}!
</div>
<div id='objectScoping'>
Hello {{@person}} {{firstName}} {{lastName}} {/person}}!
</div>
<div id='arrayIteration'>
{{#people}}
    {{firstName}} {{lastName}}<br>
{{/people}}
</div>
<div id='existenceCheck'>
{{#people}}
    {{?child}}Little {{/child}}
    {{firstName}} {{lastName}}<br>
{{/people}}
</div>
<div id='existenceWithElse'>
{{?people}}
    Yes here is the list
{{:else}}
    Nope, no one here
{{/people}}
</div>
<div id='inverseExistence'>
{{^people}}
    No people here.
{{/people}}
</div>
<div id='inverseExistenceWithElse'>
{{^people}}
    No people here.
{{:else}}
    Yes, here is the list!
{{/people}}
</div>
    </div>

    <script src='dist/amalgamate-min.js'></script>
    <script src='web/jquery.min.js'></script>
    <script src='web/bootstrap.min.js'></script>
    <script type='text/javascript'>

        var examples = [
            {
                'name': 'Replace', 'template': 'replace',
                'context': {where: 'World'}
            },
            {
                'name': 'Deep Replace', 'template': 'deepReplace',
                'context': {thisPlace: {where: 'The Internet'}}
            },
            {
                'name': 'Object Scoping', 'template': 'objectScoping',
                'context': {person: {firstName: 'Bob', lastName: 'Smith'}}
            },
            {
                'name': 'Array Iteration', 'template': 'arrayIteration',
                'context': {people: [
                    {firstName: 'Bob', lastName: 'Smith'},
                    {firstName: 'Judy', lastName: 'Smith'}
                ]}
            },
            {
                'name': 'Existence Check', 'template': 'existenceCheck',
                'context': {people: [
                    {firstName: 'Bob', lastName: 'Smith'},
                    {firstName: 'Bobby', lastName: 'Smith', child: true},
                    {firstName: 'Judy', lastName: 'Smith'}
                ]}
            },
            {
                'name': 'Existence Check (with else)', 'template': 'existenceWithElse',
                'context': {}
            },
            {
                'name': 'Inverse Existing Check', 'template': 'inverseExistence',
                'context': {}
            },
            {
                'name': 'Inverse Existing Check (with else)', 'template': 'inverseExistenceWithElse',
                'context': {people: ['people', 'list', 'goes', 'here']}
            }
        ];

        var examplesIndex = {};
        for (var i = 0, len = examples.length; i < len; i++) {
            examplesIndex[examples[i].name] = examples[i];
        }

        var populateExampleBox = function() {
            var tpl = Amalgamate.load(Amalgamate.compile(
                        "{{#examples}}<option value='{{name}}'>{{name}}</option>{{/examples}}"));
            $('#example').html(Amalgamate.render(tpl, {examples: examples}));
        };

        var updateContextAndTemplate = function() {
            var selected = examplesIndex[$('#example').val()];
            $('#template').html($('#' + selected.template).html());
            $('#context').html(JSON.stringify(selected.context, null, 4));
            render();
        };

        var render = function() {
            var out = $("#output");
            var htmlout = $("#htmlOutput");
            var time = $("#time");
            try {
                var context = JSON.parse($("#context").val());
            } catch (ex) {
                return out.html("Invalid JSON");
            }
            var template = Amalgamate.load(Amalgamate.compile($("#template").val())),
                start = performance.now(),
                output = Amalgamate.render(template, context),
                end = performance.now();

            out.html(output.replace(/</g, '&lt;'));
            htmlout.html(output);
            time.html("Template rendered in <b>" + (end - start).toFixed(3) + "ms</b>");
        };

        $('#example').change(updateContextAndTemplate);
        $('#context,#template').keyup(render);

        populateExampleBox();
        updateContextAndTemplate();
    </script>
    </body>
</html>
